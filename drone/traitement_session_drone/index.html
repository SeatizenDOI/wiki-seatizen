<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Traitement d'une session - Seatizen WIKI</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Traitement d\u0027une session";
        var mkdocs_page_input_path = "drone/traitement_session_drone.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Seatizen WIKI
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Plancha</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../plancha/before-session/">Guide de terrain</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../plancha/after-session/">Flux de traitement des donn√©es</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Blueboat</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../blueboat/materiel/">Mat√©riel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../blueboat/data/">Donn√©es</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Drone</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Traitement d'une session</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Outils pour Zenodo</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-tools/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-upload/">Envoyer une session sur Zenodo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-download/">T√©l√©charger une session depuis Zenodo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-manager/">Mettre √† jour Seatizen Atlas</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutoriels</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/acquisition-gcp/">Acquisition GCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/battery/">Gestion des batteries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/cog-server/">Ajouter un raster sur cog-server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/seatizen-monitoring/">D√©ployer Seatizen monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/ovh_nginx_ssl/">D√©ployer un site OVH - NGINX - SSL</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Autres</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../autres/photog/">Param√®tres pour la photogrammetrie</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../autres/research-changelog/">Research log</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Seatizen WIKI</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Drone</li>
      <li class="breadcrumb-item active">Traitement d'une session</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/SeatizenDOI/wiki-seatizen/edit/master/docs/drone/traitement_session_drone.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="traitement-dune-session-drone">Traitement d‚Äôune session drone</h1>
<h2 id="ce-tutoriel-decrit-le-workflow-complet-de-traitement-dune-session-drone-depuis-la-recuperation-des-images-brutes-jusqua-la-preparation-finale-des-donnees-pour-un-depot-sur-zenodo-en-sappuyant-sur-les-outils-developpes-dans-le-cadre-du-projet-seatizen">Ce tutoriel d√©crit le <strong>workflow complet de traitement d‚Äôune session drone</strong>, depuis la r√©cup√©ration des images brutes jusqu‚Äô√† la pr√©paration finale des donn√©es pour un d√©p√¥t sur <strong>Zenodo</strong>, en s‚Äôappuyant sur les outils d√©velopp√©s dans le cadre du projet <strong>Seatizen</strong>.</h2>
<h2 id="1-recuperation-des-donnees-du-drone">1. R√©cup√©ration des donn√©es du drone</h2>
<p>La premi√®re √©tape consiste √† <strong>extraire les images depuis la carte m√©moire du drone</strong>.</p>
<p>‚ö†Ô∏è <strong>Contraintes importantes :</strong></p>
<ul>
<li>Les <strong>vid√©os ne sont pas utilisables</strong> dans ce workflow.</li>
<li>Les vid√©os ne permettent pas de r√©cup√©rer des m√©tadonn√©es GPS exploitables.</li>
<li>Il est indispensable de travailler avec <strong>des images contenant des m√©tadonn√©es GPS (EXIF)</strong>.</li>
</ul>
<hr />
<h2 id="2-organisation-des-images-dossier-dcim">2. Organisation des images (dossier <code>DCIM</code>)</h2>
<p>Toutes les images doivent √™tre regroup√©es dans un dossier nomm√© :</p>
<pre><code>DCIM/
</code></pre>
<h3 id="points-de-vigilance">Points de vigilance</h3>
<ul>
<li>Certains drones r√©partissent les images dans <strong>plusieurs sous-dossiers</strong>.</li>
<li>Il peut exister <strong>des images avec le m√™me nom</strong>.</li>
<li>Si toutes les images sont copi√©es dans un seul dossier sans renommage, <strong>elles risquent de s‚Äô√©craser</strong>.</li>
</ul>
<p>üëâ Avant de poursuivre :</p>
<ul>
<li>V√©rifiez les doublons,</li>
<li>Renommez les fichiers si n√©cessaire.</li>
</ul>
<hr />
<h2 id="3-production-de-lorthophoto-avec-opendronemap-odm">3. Production de l‚Äôorthophoto avec OpenDroneMap (ODM)</h2>
<p>L‚Äôorthophoto est un <strong>√©l√©ment central du workflow</strong>, notamment pour les √©tapes d‚Äôintelligence artificielle.</p>
<p>Nous recommandons donc d‚Äôex√©cuter <strong>OpenDroneMap (ODM)</strong> en premier.</p>
<h3 id="parametres-odm-utilises">Param√®tres ODM utilis√©s</h3>
<p>Voici les param√®tres OpenDroneMap utilis√©s dans notre workflow :</p>
<pre><code class="language-bash">--project-path /datasets/code/PROCESSED_DATA/PHOTOGRAMMETRY \
--auto-boundary \
--cog \
--orthophoto-resolution 1.0 \
--rolling-shutter \
--use-exif \
--max-concurrency 128 \
--fast-orthophoto \
--optimize-disk-space \
--feature-quality ultra
</code></pre>
<p>Ces param√®tres permettent notamment :</p>
<ul>
<li>l‚Äôutilisation des m√©tadonn√©es EXIF,</li>
<li>la g√©n√©ration d‚Äôune <strong>orthophoto optimis√©e (COG)</strong>,</li>
<li>une r√©solution de 1 m,</li>
<li>une optimisation des performances et de l‚Äôespace disque,</li>
<li>une qualit√© √©lev√©e pour la d√©tection des points caract√©ristiques.</li>
</ul>
<hr />
<h2 id="4-execution-dodm-sur-datarmor-script-pbs">4. Ex√©cution d‚ÄôODM sur Datarmor (script PBS)</h2>
<p>Dans notre cas d‚Äôusage, les calculs sont effectu√©s sur le <strong>cluster Datarmor</strong>.</p>
<h3 id="transfert-des-donnees">Transfert des donn√©es</h3>
<ul>
<li>Les donn√©es sont envoy√©es sur Datarmor via <strong>FileZilla</strong> (ou √©quivalent).</li>
<li>Une fois les donn√©es disponibles sur le cluster, ODM est lanc√© via un <strong>script PBS</strong>.</li>
</ul>
<h3 id="script-pbs-odm">Script PBS ODM</h3>
<p>Le script PBS utilis√© est disponible ici :</p>
<p>üëâ <strong>Script ODM Datarmor</strong>
<a href="https://github.com/SeatizenDOI/datarmor-pbs/blob/master/odm/drone/drone_serge_may2025.pbs">https://github.com/SeatizenDOI/datarmor-pbs/blob/master/odm/drone/drone_serge_may2025.pbs</a></p>
<p>Ce script :</p>
<ul>
<li>configure l‚Äôenvironnement Datarmor,</li>
<li>lance OpenDroneMap avec les param√®tres adapt√©s,</li>
<li>g√®re l‚Äôex√©cution sur les n≈ìuds de calcul du cluster.</li>
</ul>
<hr />
<h2 id="5-workflow-dextraction-des-metadonnees">5. Workflow d‚Äôextraction des m√©tadonn√©es</h2>
<p>Une fois l‚Äôorthophoto g√©n√©r√©e, nous appliquons le workflow <strong>drone-workflow</strong> afin d‚Äôextraire et structurer les m√©tadonn√©es des images.</p>
<h3 id="commande-datarmor">Commande Datarmor</h3>
<pre><code class="language-bash">echo &quot;Working with ${SESSION_PATH}&quot;

singularity run \
  --pwd /home/seatizen/app/ \
  --bind ${PATH_DRONE_FOLDER}:/home/seatizen/sessions \
  drone_workflow.sif \
  -efol \
  -pfol /home/seatizen/sessions \
  -c \
  -ip ${PBS_ARRAY_INDEX}
</code></pre>
<p>Ce workflow permet de :</p>
<ul>
<li>lire les images et leurs m√©tadonn√©es GPS,</li>
<li>structurer les informations de session,</li>
<li>pr√©parer les fichiers n√©cessaires aux √©tapes suivantes.</li>
</ul>
<hr />
<h2 id="6-inference-automatique-sur-les-images">6. Inf√©rence automatique sur les images</h2>
<p>Une premi√®re √©tape d‚Äôinf√©rence est ensuite r√©alis√©e √† l‚Äôaide du conteneur <strong>drone-inference</strong>.</p>
<h3 id="commande-datarmor_1">Commande Datarmor</h3>
<pre><code class="language-bash">singularity run --nv \
  --pwd /home/seatizen/app/ \
  --bind /home1/datawork/villien/models:/home/seatizen/app/models \
  --bind ${PATH_DRONE_FOLDER}:/home/seatizen/sessions \
  --bind /home1/scratch/villien/:/tmp/ \
  drone_inference.sif \
  -efol \
  -pfol /home/seatizen/sessions \
  -c \
  -ip ${PBS_ARRAY_INDEX}
</code></pre>
<p>Cette √©tape permet :</p>
<ul>
<li>d‚Äôexploiter les mod√®les pr√©-entra√Æn√©s,</li>
<li>d‚Äôappliquer une premi√®re analyse automatique sur les images,</li>
<li>de produire des sorties interm√©diaires pour la segmentation finale.</li>
</ul>
<hr />
<h2 id="7-segmentation-avec-the-point-is-the-mask">7. Segmentation avec <em>The Point Is The Mask</em></h2>
<p>La segmentation fine est r√©alis√©e avec l‚Äôoutil <strong>The Point Is The Mask</strong>, bas√© sur une intelligence artificielle de segmentation.</p>
<h3 id="activation-de-lenvironnement-conda">Activation de l‚Äôenvironnement Conda</h3>
<pre><code class="language-bash">cd /home1/datahome/villien/project_hub/the-point-is-the-mask

. /appli/anaconda/latest/etc/profile.d/conda.sh
conda activate /home1/datawork/villien/conda-env/segment_env
</code></pre>
<h3 id="lancement-de-linference-de-segmentation">Lancement de l‚Äôinf√©rence de segmentation</h3>
<pre><code class="language-bash">python3 inference.py \
  -eses \
  -pses ${SESSION_PATH} \
  -po /home1/scratch/villien/drone_uav_tmp \
  -psm ./models/SegForCoral-b2-2025_06_30_19127-bs16_refine \
  --is_seatizen_session
</code></pre>
<p>Cette √©tape :</p>
<ul>
<li>segmente l‚Äôorthophoto,</li>
<li>r√©alise des pr√©dictions sur <strong>5 classes</strong>,</li>
<li>g√©n√®re des masques exploitables pour l‚Äôanalyse et l‚Äôannotation.</li>
</ul>
<hr />
<h2 id="8-depots-github-a-consulter">8. D√©p√¥ts GitHub √† consulter</h2>
<p>Pour comprendre et adapter chaque √©tape du workflow, nous vous invitons √† consulter les d√©p√¥ts suivants :</p>
<ul>
<li>
<p><strong>Drone workflow (m√©tadonn√©es)</strong>
  <a href="https://github.com/SeatizenDOI/drone-workflow">https://github.com/SeatizenDOI/drone-workflow</a></p>
</li>
<li>
<p><strong>Drone inference</strong>
  <a href="https://github.com/SeatizenDOI/drone-inference">https://github.com/SeatizenDOI/drone-inference</a></p>
</li>
<li>
<p><strong>The Point Is The Mask (segmentation)</strong>
  <a href="https://github.com/SeatizenDOI/the-point-is-the-mask/">https://github.com/SeatizenDOI/the-point-is-the-mask/</a></p>
</li>
</ul>
<hr />
<h2 id="9-preparation-finale-pour-zenodo">9. Pr√©paration finale pour Zenodo</h2>
<p>Une fois toutes les √©tapes termin√©es :</p>
<ul>
<li>orthophoto produite,</li>
<li>m√©tadonn√©es structur√©es,</li>
<li>segmentation r√©alis√©e,</li>
</ul>
<p>üëâ la <strong>session drone est compl√®te</strong> et <strong>pr√™te √† √™tre d√©pos√©e sur Zenodo</strong>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../blueboat/data/" class="btn btn-neutral float-left" title="Donn√©es"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../zenodo/zenodo-tools/" class="btn btn-neutral float-right" title="Introduction">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/SeatizenDOI/wiki-seatizen" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../blueboat/data/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../zenodo/zenodo-tools/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
