<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.ifremer.re/plancha/after-session/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Flux de traitement des donn√©es - Seatizen WIKI</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Flux de traitement des donn\u00e9es";
        var mkdocs_page_input_path = "plancha/after-session.md";
        var mkdocs_page_url = "/plancha/after-session/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Seatizen WIKI
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Plancha</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../before-session/">Guide de terrain</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Flux de traitement des donn√©es</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Blueboat</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../blueboat/materiel/">Mat√©riel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../blueboat/data/">Donn√©es</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Drone</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../drone/traitement_session_drone/">Traitement d'une session</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Outils pour Zenodo</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-tools/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-upload/">Envoyer une session sur Zenodo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-download/">T√©l√©charger une session depuis Zenodo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../zenodo/zenodo-manager/">Mettre √† jour Seatizen Atlas</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutoriels</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/acquisition-gcp/">Acquisition GCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/battery/">Gestion des batteries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/cog-server/">Ajouter un raster sur cog-server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/seatizen-monitoring/">D√©ployer Seatizen monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/ovh_nginx_ssl/">D√©ployer un site OVH - NGINX - SSL</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Autres</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../autres/photog/">Param√®tres pour la photogrammetrie</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../autres/research-changelog/">Research log</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Seatizen WIKI</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Plancha</li>
      <li class="breadcrumb-item active">Flux de traitement des donn√©es</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/SeatizenDOI/wiki-seatizen/edit/master/docs/plancha/after-session.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="traiter-une-session-de-planche">Traiter une session de planche</h1>
<h2 id="dechargement-des-donnees-brutes">D√©chargement des donn√©es brutes</h2>
<p>Cr√©er un dossier <code>tmp</code> pour stocker temporairement les fichiers <strong>bruts</strong>. Le fichier du Reach RS3 se place √† la racine, tandis qu'il faut cr√©er un dossier sp√©cifique par planche.</p>
<h3 id="gps-base-reach-rs3">GPS Base - Reach RS3</h3>
<p>Dans un premier temps, r√©cup√©rez les donn√©es sur le Reach RS2/3 :</p>
<ul>
<li>Allumez-le sans partage de connexion ; au bout d'un moment, il passera en mode <strong>point d'acc√®s (hotspot)</strong>.</li>
<li>Connectez-vous √† son r√©seau Wi-Fi (le code est <code>emlidreach</code>).</li>
<li>Une fois connect√©, rendez-vous sur l'URL <code>192.168.42.1</code>.</li>
<li>Allez dans l'onglet <strong>Logging</strong> et t√©l√©chargez l'archive <code>.zip</code> du jour.</li>
<li><em>Note : Sur les anciens firmwares, t√©l√©chargez manuellement les fichiers LLH et RINEX.</em></li>
</ul>
<h3 id="gps-device-reach-m2">GPS Device - Reach M2</h3>
<p>Pour le GPS de la planche :</p>
<ul>
<li>Allumez la planche. Au bout d'une minute ou deux, le Reach M2 passe en hotspot.</li>
<li>Connectez-vous au r√©seau (mot de passe : <code>emlidreach</code>).</li>
<li>Rendez-vous sur l'URL <code>192.168.42.1</code> dans l'onglet <strong>Logging</strong>.</li>
<li>T√©l√©chargez le fichier <code>.zip</code> (ou les fichiers LLH et RINEX pour les anciens firmwares) dans le dossier <code>tmp</code> de la planche associ√©e. Il y a autant de fichiers .zip que de sessions r√©alis√©es.</li>
</ul>
<h3 id="fichiers-de-lautopilote">Fichiers de l'autopilote</h3>
<p>L'autopilote (le Cube Orange) g√©n√®re un fichier par mission, √† condition d'avoir √©teint la planche entre chaque session.</p>
<ul>
<li>Retirez la carte micro-SD et branchez-la sur le PC.</li>
<li>Acc√©dez au dossier <code>APM/LOGS</code>. Il contient des fichiers <code>.BIN</code> nomm√©s par num√©ros.</li>
<li>Ils sont class√©s par <strong>ordre chronologique</strong>. Vous pouvez v√©rifier cet ordre gr√¢ce au script <code>utils/verify_bin.py</code> du d√©p√¥t GitHub <a href="https://github.com/SeatizenDOI/plancha-workflow">plancha-workflow</a>.</li>
<li><strong>Copiez</strong> les fichiers <code>.BIN</code> dans le dossier temporaire de la planche, puis supprimez les fichiers sur la carte SD ainsi que le fichier <code>.txt</code> de 4 octets.</li>
</ul>
<h3 id="donnees-video">Donn√©es vid√©o</h3>
<ul>
<li>R√©cup√©rez les vid√©os sur la carte SD de la GoPro.</li>
<li>Pour diff√©rencier les fichiers appartenant √† une m√™me session, observez les deux derniers chiffres du nom de fichier (ils restent identiques pour les chapitres d'une m√™me vid√©o). ``</li>
</ul>
<h3 id="rassembler-les-donnees-brutes">Rassembler les donn√©es brutes</h3>
<p>Pour chaque session, cr√©ez un dossier respectant la nomenclature suivante :</p>
<p><code>YYYYMMDD_country-code-optinal-place_device_session-number</code></p>
<p><strong>Exemple pour deux planches et deux sessions √† Saint-Leu :</strong></p>
<ul>
<li>20250411_REU-ST-LEU_ASV-1_01</li>
<li>20250411_REU-ST-LEU_ASV-1_02</li>
<li>20250411_REU-ST-LEU_ASV-2_01</li>
<li>20250411_REU-ST-LEU_ASV-2_02</li>
</ul>
<p><strong>Chaque dossier de session doit contenir l'arborescence suivante :</strong></p>
<pre><code class="language-text">.20250411_REU-ST-LEU_ASV-1_01
    ‚îú‚îÄ‚îÄ DCIM       (Vid√©os GoPro)
    ‚îú‚îÄ‚îÄ GPS
    ‚îÇ    ‚îú‚îÄ‚îÄ BASE     (Donn√©es du Reach RS3)
    ‚îÇ    ‚îî‚îÄ‚îÄ DEVICE   (Donn√©es du Reach M2)
    ‚îî‚îÄ‚îÄ SENSORS    (Fichier .BIN de la session)

</code></pre>
<p>√Ä ce stade, les donn√©es brutes sont class√©es et pr√™tes √† √™tre exploit√©es.</p>
<blockquote>
<p><strong>‚ö†Ô∏è Important :</strong> Il est n√©cessaire de noter les sessions r√©alis√©es dans un fichier Excel pour assurer le suivi.</p>
<p><strong>‚ö†Ô∏è Conseil de s√©curit√© :</strong> En cas de doute ou de mauvaise manipulation, privil√©giez toujours le <strong>copier-coller</strong> suivi d'une suppression manuelle plut√¥t que le d√©placement direct des fichiers.</p>
</blockquote>
<hr />
<h2 id="traitement-des-donnees-synchronisation-images-et-donnees-temporelles">Traitement des donn√©es : Synchronisation Images et Donn√©es Temporelles</h2>
<p>Actuellement, les donn√©es brutes ne sont pas directement exploitables : les vid√©os ne poss√®dent pas de coordonn√©es GPS associ√©es, la bathym√©trie n'est pas corrig√©e et le GPS n'est pas encore trait√© en <strong>PPK</strong> (Post-Processed Kinematic).</p>
<p>Pour automatiser ce flux, nous utilisons le d√©p√¥t <a href="https://github.com/SeatizenDOI/plancha-workflow">plancha-workflow</a>. Reportez-vous au <code>README</code> pour l'installation de l'environnement.</p>
<h3 id="1-gestion-des-sessions-par-batch-fichier-csv">1. Gestion des sessions par batch (Fichier CSV)</h3>
<p>Pour traiter plusieurs sessions simultan√©ment, utilisez l'option <code>-csv</code>. Il est fortement recommand√© d'utiliser un fichier CSV pour conserver une trace des param√®tres appliqu√©s.</p>
<p><strong>Exemple de structure CSV :</strong></p>
<pre><code class="language-csv">session_name,time_first_frame,number_first_frame,filt_exclude_specific_timeUS,depth_range_max,depth_range_min,filt_exclude_specific_datetimeUTC,rgp_station
20240607_REU-HERMITAGE_ASV-1_01,2024:06:07 03:07:19.60,20,,20,,,
20250414_REU-TROU-DEAU_ASV-1_03,2025:04:14 04:29:56.00,10,&quot;[[201262382,219662452]]&quot;,,,,

</code></pre>
<blockquote>
<p>‚ö†Ô∏è <strong>Note :</strong> Si vous n'utilisez pas de CSV, vous devrez configurer manuellement le fichier <code>ppk_config.json</code>.</p>
</blockquote>
<h3 id="etape-1-synchronisation-temporelle-et-premieres-corrections">√âtape 1 : Synchronisation temporelle et premi√®res corrections</h3>
<p>L'objectif est de trouver le d√©calage entre l'horloge de la cam√©ra et le temps GPS.</p>
<ol>
<li><strong>R√©cup√©ration de l'heure :</strong> Ex√©cutez la commande suivante :
<code>python workflow.py -csv csv/2025_plancha.csv -os</code></li>
<li><strong>Analyse des frames :</strong> Allez dans le dossier <code>PROCESSED_DATA/FRAMES</code>. Trouvez la frame affichant l'heure, notez son num√©ro (<code>number_first_frame</code>) et l'heure affich√©e.</li>
<li><strong>Conversion UTC :</strong> Soustrayez <strong>4 heures</strong> (pour La R√©union) pour obtenir l'heure UTC. Exemple : <code>07:07:19.60</code> devient <code>03:07:19.60</code> dans le CSV.</li>
<li><strong>V√©rification Qualit√© :</strong></li>
<li><strong>GPS :</strong> Consultez <code>GPS/DEVICE/GPS_ppk_position_accuracy.png</code>. Un bon g√©or√©f√©rencement doit afficher environ <strong>90% de Q1 (Fix)</strong>.</li>
<li><strong>Bathy :</strong> V√©rifiez <code>PROCESSED_DATA/BATHY/depth_samples_utmcoord_preproc.png</code>. Si des valeurs sont aberrantes, renseignez les colonnes <code>depth_range_max</code> ou <code>min</code> dans votre CSV.</li>
</ol>
<h3 id="etape-2-traitement-complet">√âtape 2 : Traitement complet</h3>
<p>Une fois la synchronisation renseign√©e dans le CSV, relancez le processus global :
<code>python workflow.py -csv csv/2025_plancha.csv</code></p>
<p><strong>Ce que fait le script :</strong></p>
<ul>
<li><strong>D√©coupage :</strong> Extraction √† <strong>2.997 fps</strong> (adapt√© au format GoPro 23.98 fps).</li>
<li><strong>G√©olocalisation :</strong> Attribution d'une position GPS pr√©cise √† chaque image.</li>
<li><strong>M√©tadonn√©es :</strong> √âcriture des donn√©es dans les tags <strong>EXIF</strong> (position, attitude, etc.).</li>
</ul>
<h3 id="resultats">R√©sultats</h3>
<div align="center">
    <figure>
        <img src="/img/plancha/fin_gps.png" alt="Fichier GPS.">
        <figcaption>Fichier repr√©sentant les positions de la planches. 70% de Q1 est suffisant pour passer √† la suite.</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
        <img src="/img/plancha/fin_bathy.png" alt="Fichier bathy.">
        <figcaption>Fichier pour visualiser la bathy. Ici l'interpolation a bien march√© et on a pas de morceau qui sort.</figcaption>
    </figure>
</div>

<p>On peut v√©rifier les m√©tadonn√©es d'une image avec la commande :</p>
<pre><code class="language-bash">exiftool -a -n -g /media/bioeos/D/202312_plancha_session/20231207_REU-HERMITAGE_ASV-1_02/PROCESSED_DATA/FRAMES/20231207_REU-HERMITAGE_ASV-1_02_1_1231.jpeg
</code></pre>
<p>et on obtient</p>
<pre><code class="language-txt">---- ExifTool ----
ExifTool Version Number         : 12.76
---- File ----
File Name                       : 20231207_REU-HERMITAGE_ASV-1_02_1_1231.jpeg
Directory                       : /media/bioeos/D/202312_plancha_session/20231207_REU-HERMITAGE_ASV-1_02/PROCESSED_DATA/FRAMES
File Size                       : 1102133
File Modification Date/Time     : 2024:05:24 18:55:26+04:00
File Access Date/Time           : 2026:01:21 17:35:14+04:00
File Inode Change Date/Time     : 2024:05:24 19:04:29+04:00
File Permissions                : 100664
File Type                       : JPEG
File Type Extension             : JPG
MIME Type                       : image/jpeg
Exif Byte Order                 : MM
Comment                         : Lavc58.134.100
Image Width                     : 3840
Image Height                    : 2160
Encoding Process                : 0
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : 2 2
---- JFIF ----
JFIF Version                    : 1 2
Resolution Unit                 : 0
X Resolution                    : 72
Y Resolution                    : 1
---- EXIF ----
Image Width                     : 3840
Image Height                    : 2160
Bits Per Sample                 : 8Dernier point de l'interval √† retirer
Camera Model Name               : HERO8 Black
X Resolution                    : 72
Y Resolution                    : 1
Resolution Unit                 : 1
Y Cb Cr Sub Sampling            : 2 2
Y Cb Cr Positioning             : 1
Exif Version                    : 0232
Date/Time Original              : 2023:12:07 03:52:57
Components Configuration        : 1 2 3 0
Exposure Compensation           : 0
Focal Length                    : 2.92
Sub Sec Time Original           : 297397000
Flashpix Version                : 0100
Color Space                     : 65535
Focal Length In 35mm Format     : 15
Sharpness                       : 1
Lens Serial Number              : C3341327809152
GPS Version ID                  : 2 3 0 0
GPS Latitude Ref                : S
GPS Latitude                    : 21.0872743786806
GPS Longitude Ref               : E
GPS Longitude                   : 55.2264079169917
GPS Altitude Ref                : 1
GPS Altitude                    : 0.69
Camera Serial Number            : C3331353137142
---- XMP ----
XMP Toolkit                     : Image::ExifTool 12.40
GPS Pitch                       : -1.09227367931115
GPS Roll                        : -2.76290844206535
GPS Track                       : 144.349900596421
Video Frame Rate                : 23.976
---- Composite ----
Image Size                      : 3840 2160
Megapixels                      : 8.2944
Scale Factor To 35 mm Equivalent: 5.13698630136986
Date/Time Original              : 2023:12:07 03:52:57.297397000
GPS Altitude                    : -0.69
GPS Latitude                    : -21.0872743786806
GPS Longitude                   : 55.2264079169917
Circle Of Confusion             : 0.00584900540241936
Field Of View                   : 100.388942610382
Focal Length                    : 15
GPS Position                    : -21.0872743786806 55.2264079169917
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="probleme-gps-reach-rs23">Probl√®me GPS (Reach RS2/3)</h3>
<p>Si les donn√©es de votre base RS3 sont de mauvaise qualit√© (GPSFix 5 ou absent), utilisez les stations du <strong>RGP (IGN)</strong>.</p>
<ol>
<li>Identifiez la station la plus proche sur <a href="https://rgp.ign.fr/">rgp.ign.fr</a>.</li>
<li>Modifiez <code>ppk_config.json</code> :</li>
</ol>
<pre><code class="language-json">&quot;rgp_station&quot;: &quot;lepo&quot;,
&quot;force_use_rgp&quot;: true

</code></pre>
<hr />
<h3 id="correction-dune-trajectoire-derivante-dans-la-bathymetrie">Correction d'une trajectoire d√©rivante dans la bathym√©trie</h3>
<div align="center">
    <figure>
        <img src="/img/plancha/ex_bathy_1.png" alt="Visualisation bathym√©trique avec erreur de trajectoire.">
        <figcaption>Visualisation de la bathym√©trie brute pr√©sentant un artefact de trajectoire.</figcaption>
    </figure>
</div>

<p>Il arrive que le fichier <code>depth_samples_utm_coord_preproc.png</code> affiche une trajectoire sortant du transect d'√©tude. Ce ph√©nom√®ne survient g√©n√©ralement lors d'une mise en manuel de l'ASV ou d'une d√©rive lors de la mise √† l'eau. Pour obtenir un raster final propre, il est n√©cessaire de filtrer ces donn√©es aberrantes.</p>
<p><strong>M√©thode de filtrage :</strong></p>
<ol>
<li>Ouvrez le fichier interactif <code>webmap_usv_track.html</code> situ√© dans le dossier <code>BATHY</code>.</li>
<li>Identifiez visuellement le segment √† supprimer.</li>
<li>Cliquez sur les points correspondant au <strong>d√©but</strong> et √† la <strong>fin</strong> de la zone de d√©rive pour relever leurs valeurs respectives de <code>timeUS</code>.</li>
</ol>
<p>Dans cet exemple, nous avons identifi√© les bornes suivantes : <strong>641643950</strong> et <strong>700444139</strong>.</p>
<div align="center">
    <figure>
        <img src="/img/plancha/ex_bathy_2.png" alt="S√©lection du point initial sur la carte.">
        <figcaption>Localisation du premier point du segment √† exclure.</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
    <img src="/img/plancha/ex_bathy_3.png" alt="Zoom sur les coordonn√©es temporelles.">
        <figcaption>Zoom sur la valeur timeUS du point initial.</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
        <img src="/img/plancha/ex_bathy_4.png" alt="S√©lection du point final sur la carte.">
        <figcaption>Localisation du dernier point de l'intervalle √† retirer.</figcaption>
    </figure>
</div>

<blockquote>
<p><strong>Astuce :</strong> Pour plus de pr√©cision, vous pouvez augmenter le niveau de zoom maximal en modifiant directement les param√®tres dans le code source du fichier <code>.html</code>.</p>
</blockquote>
<p><strong>Application de la correction :</strong></p>
<p>Reportez l'intervalle temporel dans la colonne <code>filt_exclude_specific_timeUS</code> de votre fichier CSV, puis relancez le traitement :</p>
<pre><code class="language-csv">session_name,time_first_frame,number_first_frame,filt_exclude_specific_timeUS,depth_range_max,depth_range_min,filt_exclude_specific_datetimeUTC,rgp_station
20231127_REU-HERMITAGE_ASV-2_03,2023:11:27 05:47:50.42,30,&quot;[[641643950, 700444139]]&quot;,,,,

</code></pre>
<p><strong>R√©sultat apr√®s filtrage :</strong></p>
<div align="center">
    <figure>
        <img src="/img/plancha/ex_bathy_5.png" alt="Visualisation bathym√©trique corrig√©e.">
        <figcaption>Bathym√©trie finale apr√®s exclusion du segment de d√©rive.</figcaption>
    </figure>
</div>

<hr />
<h3 id="suppression-des-trajectoires-indesirables-dans-les-metadonnees-session-20231213_reu-etang-sale_asv-2_01">Suppression des trajectoires ind√©sirables dans les m√©tadonn√©es (Session 20231213_REU-ETANG-SALE_ASV-2_01)</h3>
<p>Une fois les deux √©tapes de traitement termin√©es, l'import du fichier <code>metadata.csv</code> dans QGIS peut parfois r√©v√©ler des anomalies de trajectoire :</p>
<div align="center">
    <figure>
        <img src="/img/plancha/ex_metadata_2.png" alt="Visualisation QGIS des m√©tadonn√©es avec erreurs.">
        <figcaption>Visualisation des m√©tadonn√©es montrant des segments d√©rivant vers la plage.</figcaption>
    </figure>
</div>

<p>On observe ici des trac√©s qui s'√©tendent jusqu'au rivage. Ce probl√®me survient g√©n√©ralement lorsque la session ne contient pas de fichier <strong>.BIN</strong> dans le dossier <code>SENSORS</code> : le programme ne parvient pas √† d√©tecter automatiquement les points de d√©but et de fin de mission.</p>
<p><strong>Proc√©dure de filtrage manuel :</strong></p>
<p>Pour nettoyer le jeu de donn√©es, nous devons d√©finir manuellement les intervalles de temps √† exclure. Dans ce cas pr√©cis, nous isolons deux p√©riodes (le trajet aller vers la zone et le trajet retour apr√®s la mission).</p>
<div align="center">
    <figure>
        <img src="/img/plancha/ex_metadata_3.png" alt="Identification du point de d√©part du transect.">
        <figcaption>S√©lection du point limite avant le d√©but effectif de l'acquisition.</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
        <img src="/img/plancha/ex_metadata_4.png" alt="Identification du point de fin du transect.">
        <figcaption>S√©lection du point limite apr√®s la fin de l'acquisition.</figcaption>
    </figure>
</div>

<p>Les deux intervalles identifi√©s pour suppression sont :
<code>[['2023:12:13 03:22:04.0','2023:12:13 03:25:25.0'],['2023:12:13 04:07:03.0','2023:12:13 04:18:48.0']]</code></p>
<blockquote>
<p><strong>Note :</strong> Un filtrage l√©g√®rement large est pr√©f√©rable pour √©liminer les accumulations d'images stagnantes sur un m√™me point en bord de c√¥te.</p>
</blockquote>
<p><strong>Relance du traitement :</strong></p>
<p>Il est n√©cessaire de relancer l'int√©gralit√© de la pipeline (incluant l'extraction des images) en renseignant la colonne <code>filt_exclude_specific_datetimeUTC</code> dans votre CSV :</p>
<pre><code class="language-csv">session_name,time_first_frame,number_first_frame,filt_exclude_specific_timeUS,depth_range_max,depth_range_min,filt_exclude_specific_datetimeUTC,rgp_station
20231213_REU-ETANG-SALE_ASV-2_01,2023:12:13 03:21:47.15,20,,,,&quot;[['2023:12:13 03:22:04.0','2023:12:13 03:25:25.0'],['2023:12:13 04:07:03.0','2023:12:13 04:18:48.0']]&quot;,

</code></pre>
<p><strong>R√©sultat final :</strong></p>
<div align="center">
    <figure>
        <img src="/img/plancha/ex_metadata_1.png" alt="M√©tadonn√©es nettoy√©es dans QGIS.">
        <figcaption>Jeu de donn√©es final, propre et pr√™t pour l'analyse.</figcaption>
    </figure>
</div>

<h2 id="application-de-lia-inference">Application de l'IA (Inf√©rence)</h2>
<p>Le traitement se poursuit par l'application de deux mod√®les d'intelligence artificielle successifs pour trier et analyser les images.</p>
<h3 id="1-filtrage-avec-le-modele-jacques">1. Filtrage avec le mod√®le "Jacques"</h3>
<p>La premi√®re √©tape utilise <a href="https://zenodo.org/records/8159227">Jacques</a>, un mod√®le bas√© sur l'architecture <strong>ResNet</strong>, con√ßu pour classer les images en deux cat√©gories : <strong>utiles</strong> ou <strong>inutiles</strong>.</p>
<p>Le filtrage √©limine les images de "grand bleu", ainsi que celles montrant le ciel ou la plage. Ce processus r√©pond √† deux objectifs :</p>
<ul>
<li><strong>√âthique et RGPD :</strong> Garantir qu'aucun visage identifiable n'est publi√© sans consentement.</li>
<li><strong>Optimisation :</strong> √âviter de solliciter le second mod√®le, plus complexe, pour analyser des images sans int√©r√™t biologique.</li>
</ul>
<div align="center">
    <figure>
        <img src="/img/plancha/utiles.png" alt="Exemples d'images utiles.">
        <figcaption>Exemples d'images consid√©r√©es comme exploitables.</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
        <img src="/img/plancha/inutiles.png" alt="Exemples d'images inutiles.">
        <figcaption>Exemples d'images √† exclure (hors zone ou pr√©sence humaine).</figcaption>
    </figure>
</div>

<h3 id="2-analyse-biologique-avec-dinovdeau">2. Analyse biologique avec "DinoVdeau"</h3>
<p>Le second mod√®le, <a href="https://github.com/SeatizenDOI/DinoVdeau">DinoVdeau</a>, est un mod√®le entra√Æn√© √† partir de Dinov2. Il identifie simultan√©ment plusieurs cat√©gories sur une m√™me image.</p>
<ul>
<li><strong>Donn√©es d'entra√Ænement :</strong> Disponible sur <a href="https://huggingface.co/datasets/lombardata/seatizen_atlas_image_dataset">HuggingFace</a> et <a href="https://doi.org/10.5281/zenodo.12819156">Zenodo</a>.</li>
</ul>
<div align="center">
    <figure>
        <img src="/img/plancha/dinovdeau.png" alt="Architecture du mod√®le DinoVdeau">
        <figcaption>Architecture globale du mod√®le DinoVdeau.</figcaption>
    </figure>
</div>

<hr />
<h3 id="execution-de-linference">Ex√©cution de l'inf√©rence</h3>
<p>Pour lancer l'analyse, utilisez le d√©p√¥t <a href="https://github.com/SeatizenDOI/plancha-inference">plancha-inference</a>. Une fois l'environnement configur√©, ex√©cutez la commande suivante :</p>
<pre><code class="language-bash">python inference.py -efol -pfol /chemin/vers/votre/dossier -c

</code></pre>
<h3 id="resultats-obtenus">R√©sultats obtenus</h3>
<p>En fin de calcul, le script g√©n√®re trois types de fichiers :</p>
<ol>
<li><strong>Un fichier de pr√©dictions :</strong> Regroupe les scores de classification associ√©s aux coordonn√©es GPS.</li>
<li><strong>Un raster interpol√© :</strong> Une carte de pr√©sence/absence g√©n√©r√©e √† partir des pr√©dictions (l'aspect r√©gulier du transect est important pour obtenir une interpolation de qualit√©).</li>
<li><strong>Un rapport PDF :</strong> Un document de synth√®se r√©capitulant les statistiques de la session.</li>
</ol>
<div align="center">
    <figure>
        <img src="/img/plancha/fin_pdf.png" alt="Exemple de rapport PDF.">
        <figcaption>Synth√®se des r√©sultats au format PDF.</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
        <img src="/img/plancha/fin_pred_score.png" alt="Visualisation des scores de pr√©diction">
        <figcaption>Distribution spatiale des scores (ex : pr√©sence d'Acropores branchus).</figcaption>
    </figure>
</div>

<div align="center">
    <figure>
        <img src="/img/plancha/fin_pred_raster.png" alt="Raster de pr√©diction interpol√©.">
        <figcaption>Raster final interpol√© repr√©sentant la densit√© de l'esp√®ce cibl√©e.</figcaption>
    </figure>
</div>

<h2 id="generation-dorthophotos">G√©n√©ration d'orthophotos</h2>
<p>La cr√©ation d'orthophotos est une t√¢che gourmande en ressources. Pour cette raison, l'utilisation du cluster <strong>Datarmor</strong> est indispensable.</p>
<p>Un script sp√©cifique permet d'automatiser ce processus via <strong>OpenDroneMap (ODM)</strong> :</p>
<p>üëâ <strong><a href="https://github.com/SeatizenDOI/datarmor-pbs/blob/master/odm/asv/asv_light.pbs">Script ODM Datarmor (asv_light.pbs)</a></strong></p>
<p><strong>Ce script assure les fonctions suivantes :</strong></p>
<ul>
<li>Configuration automatique de l'environnement logiciel sur Datarmor.</li>
<li>Lancement d'OpenDroneMap avec des param√®tres optimis√©s pour les donn√©es ASV.</li>
</ul>
<h2 id="publication-et-synchronisation-des-donnees">Publication et synchronisation des donn√©es</h2>
<h3 id="1-archivage-sur-zenodo-et-mise-a-jour-de-latlas">1. Archivage sur Zenodo et mise √† jour de l'Atlas</h3>
<p>Une fois les donn√©es trait√©es, la session doit √™tre mise en ligne pour garantir sa p√©rennit√©. Veuillez vous r√©f√©rer aux guides de la section <a href="../../zenodo/zenodo-tools/">Outils pour Zenodo</a> pour :</p>
<ul>
<li>T√©l√©verser vos sessions sur <strong>Zenodo</strong>.</li>
<li>Synchroniser les m√©tadonn√©es avec la base de donn√©es <strong>Seatizen Atlas</strong>.</li>
</ul>
<h3 id="2-hebergement-des-rasters-sur-le-serveur-cog">2. H√©bergement des rasters sur le serveur COG</h3>
<p>La derni√®re √©tape consiste √† rendre les couches cartographiques accessibles via le serveur <strong>COG (Cloud Optimized GeoTIFF)</strong>.</p>
<p>Vous devrez rassembler les rasters suivants :</p>
<ul>
<li><strong>Bathym√©trie</strong> corrig√©e.</li>
<li><strong>Pr√©dictions IA</strong> (cartes de scores).</li>
<li><strong>Orthophotos</strong> g√©n√©r√©es sur Datarmor.</li>
</ul>
<p>Toutes les instructions de d√©ploiement sont d√©taill√©es sur le d√©p√¥t <a href="https://github.com/SeatizenDOI/cog-server">cog-server</a> ou directement dans l'onglet <a href="../../tutoriels/cog-server/">Ajouter un raster sur cog-server</a> de cette documentation.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../before-session/" class="btn btn-neutral float-left" title="Guide de terrain"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../blueboat/materiel/" class="btn btn-neutral float-right" title="Mat√©riel">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/SeatizenDOI/wiki-seatizen" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../before-session/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../blueboat/materiel/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
