<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.ifremer.re/zenodo/zenodo-manager/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Mettre à jour Seatizen Atlas - Seatizen WIKI</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Mettre \u00e0 jour Seatizen Atlas";
        var mkdocs_page_input_path = "zenodo/zenodo-manager.md";
        var mkdocs_page_url = "/zenodo/zenodo-manager/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Seatizen WIKI
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Plancha</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../plancha/before-session/">Guide de terrain</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../plancha/after-session/">Flux de traitement des données</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Blueboat</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../blueboat/materiel/">Matériel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../blueboat/data/">Données</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Drone</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../drone/traitement_session_drone/">Traitement d'une session</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Outils pour Zenodo</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../zenodo-tools/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../zenodo-upload/">Envoyer une session sur Zenodo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../zenodo-download/">Télécharger une session depuis Zenodo</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Mettre à jour Seatizen Atlas</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutoriels</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/acquisition-gcp/">Acquisition GCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/battery/">Gestion des batteries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/cog-server/">Ajouter un raster sur cog-server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/seatizen-monitoring/">Déployer Seatizen monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutoriels/ovh_nginx_ssl/">Déployer un site OVH - NGINX - SSL</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Autres</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../autres/photog/">Paramètres pour la photogrammetrie</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../autres/research-changelog/">Research log</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Seatizen WIKI</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Outils pour Zenodo</li>
      <li class="breadcrumb-item active">Mettre à jour Seatizen Atlas</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/SeatizenDOI/wiki-seatizen/edit/master/docs/zenodo/zenodo-manager.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mettre-a-jour-seatizen-atlas">Mettre à jour Seatizen Atlas</h1>
<h2 id="comment-fonctionne-seatizen-atlas">Comment fonctionne Seatizen Atlas</h2>
<p>Seatizen Atlas est une base de données SQLite stockée au format GeoPackage afin d'intégrer une dimension spatiale. Son but est de rassembler les métadonnées de chaque session Seatizen présente sur Zenodo.</p>
<p>Il est possible d'utiliser le logiciel <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a> pour explorer la base de données.</p>
<p>Voici son diagramme UML :</p>
<div align="center">
    <figure>
        <img src="/img/zenodo/zm_uml.png" alt="UML de Seatizen Atlas">
        <figcaption>Figure 3 : UML de Seatizen Atlas</figcaption>
    </figure>
</div>

<p>Elle stocke les métadonnées des images (table <code>frame</code>), ainsi que l'ensemble des métadonnées des prédictions et des annotations multilabels (partie en jaune).</p>
<p>Le script <code>zenodo-manager.py</code> permet de :</p>
<ul>
<li>Ajouter une ou plusieurs sessions dans la base de données. Attention : la session doit être présente sur le PC de l'utilisateur (sinon, voir <code>zenodo-auto-update.py</code>).</li>
<li>Mettre à jour la base de données à partir d'un script SQL.</li>
<li>Générer des fichiers CSV, Parquet et une archive au format Darwin Core.</li>
<li>Téléverser la base de données sur Zenodo.</li>
<li>Mettre à jour les métadonnées de la dernière version sur Zenodo.</li>
<li>Ajouter des annotations (voir cheatsheet).</li>
</ul>
<p>Le script <code>zenodo-auto-update.py</code> est plus simple d'utilisation. À partir d'une ou plusieurs communautés sur Zenodo, il met à jour la base de données locale en téléchargeant uniquement les sessions créées ou modifiées depuis le dernier moissonnage (voir table <code>etl_runs</code> du GeoPackage). Le script télécharge la dernière version des archives <code>METADATA.zip</code> et <code>PROCESSED_DATA_IA.zip</code>. Si les données de Zenodo ne sont pas encore présentes dans la base, il extrait les informations nécessaires puis supprime les dossiers locaux.</p>
<h2 id="cheatsheet-de-commandes">Cheatsheet de commandes</h2>
<p>Exemples de commandes pour mettre en ligne ou à jour des sessions et la base de données.</p>
<p>Mettre les métadonnées à jour d'un dossier de sessions (<code>-um</code>) avec le fichier de métadonnées <code>metadata/metadata.json</code></p>
<pre><code class="language-bash">python zenodo-upload.py -efol -pfol /media/bioeos/D/202312_plancha_session -um -pmj metadata/metadata.json
</code></pre>
<p>Attention, la commande ci-dessus met à jour TOUTES les version d'un dépôt sur zenodo. Pour mettre à jour que la dernière version, il faut utiliser l'argument <code>-umlv</code></p>
<hr />
<p>Mettre en ligne un dossier de sessions. On aura une version de données brutes (<code>-ur</code>) et une version de processed_data (<code>-up</code>) avec les dossiers frames, metadata, et photogrammetrie. Le fichier de métadonnées à utiliser est <code>./metadata/metadata_recif3D.json</code>. On force l'envoie des frames car on a pas utilisé Jacques pour filtrer les images inutiles (image sous-marine d'AUV).</p>
<pre><code class="language-bash">python zenodo-upload.py -efol -pfol ./recif3D_sessions_folder/ -ur -up pmf -pmj ./metadata/metadata_recif3D.json --all_frames_without_filtering_by_useful
</code></pre>
<hr />
<p>Récupère tous les deposits sur Zenodo et supprime ceux qui sont vierges, sans titre et en mode brouillon (Erreur lors d'un envoi, dépôt fantôme)</p>
<pre><code class="language-bash">python  zenodo-upload.py -eno -cd
</code></pre>
<hr />
<p>Applique le script SQL numéro 3 sur le geopackage. Il doit être rangé dans le dossier <code>https://github.com/SeatizenDOI/zenodo-tools/tree/master/src/sql_connector</code></p>
<pre><code class="language-bash">python  zenodo-manager.py -eno -ssn 3
</code></pre>
<hr />
<p>Exporte tous les fichiers dérivés de la base de données (CSV, Parquet, darwin core, ...)</p>
<pre><code class="language-bash">python zenodo-manager.py -eno -ulo
</code></pre>
<hr />
<p>Régènère une base de données de zéro (<code>-fr</code>) localement (<code>-ulo</code>) et ajoute un dossier de sessions en forcant l'insertion des frames (n'utilise pas Jacques) (<code>-ffi</code>). Le programme ne génère pas les fichiers dérivés. </p>
<pre><code class="language-bash">python zenodo-manager.py -efol -pfol /media/bioeos/E/2015_plancha_session/ -ulo -ffi -fr -ne # Force inserting frame in database with no export and regenerate database.

</code></pre>
<hr />
<p>Envoie sur zenodo une nouvelle version de la base de donnée (<code>-cp</code>).  Le programme ne regénère pas les fichiers dérivés. </p>
<pre><code class="language-bash">python zenodo-manager.py -eno -ulo -cp -ne
</code></pre>
<hr />
<p>Ajoute des annotations dans la base de données (<code>-la</code>).</p>
<pre><code class="language-bash">python zenodo-manager.py -eno -ulo -la ../../Bioeos/annotations_some_image/Export_human/ -ne # Add frames and import annotations.
</code></pre>
<p>Un fichier suit un certaine nommage <code>date_time__author-name__dataset-name.csv</code>. Par exemple, voici le fichier <code>20240524_151409__victor-russias__annotations_over_predictions_1.csv</code>: </p>
<pre><code class="language-csv">FileName,Acropore_branched,Acropore_digitised,Acropore_sub_massive,Acropore_tabular,Algae_assembly,Algae_drawn_up,Algae_limestone,Algae_sodding,Atra/Leucospilota,Bleached_coral,Blurred,Dead_coral,Fish,Homo_sapiens,Human_object,Living_coral,Millepore,No_acropore_encrusting,No_acropore_foliaceous,No_acropore_massive,No_acropore_solitary,No_acropore_sub_massive,Rock,Rubble,Sand,Sea_cucumber,Sea_urchins,Sponge,Syringodium_isoetifolium,Thalassodendron_ciliatum,Useless
20230203_REU-GRANDFOND_ASV-1_00_1_197.jpeg,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0
20230203_REU-GRANDFOND_ASV-1_00_1_201.jpeg,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0
20230203_REU-GRANDFOND_ASV-1_00_1_212.jpeg,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0
20230203_REU-GRANDFOND_ASV-1_00_1_218.jpeg,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0
</code></pre>
<p>Si une image n'est pas présente déjà dans la table frames (lié à un DOI), on ne garde pas. Si un label d'annotation n'est pas présent dans la base de données, on n'ajoute pas l'annotation. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../zenodo-download/" class="btn btn-neutral float-left" title="Télécharger une session depuis Zenodo"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../tutoriels/acquisition-gcp/" class="btn btn-neutral float-right" title="Acquisition GCP">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/SeatizenDOI/wiki-seatizen" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../zenodo-download/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../tutoriels/acquisition-gcp/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
